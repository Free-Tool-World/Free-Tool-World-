  
    <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Background Remover & Optimizer - Free Online Tool</title>
  <meta name="description" content="Free online tool to remove backgrounds from images and optimize them by adjusting compression. Supports PNG, JPG, WebP formats.">
  <meta name="keywords" content="remove background, image optimizer, image compressor, background remover, png background, jpg optimizer, webp optimizer, free tool, online tool">
  <!-- Google AdSense Script - Replace with your script
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID"
       crossorigin="anonymous"></script>
  -->
  <style>
    body {
      background-color: #ffffff;
      color: #2563eb;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      padding: 1rem;
      box-sizing: border-box;
    }
    .container {
      padding: 2rem;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background-color: #ffffff;
    }
    input, select, button {
      width: 100%;
      margin-top: 1rem;
      padding: 0.5rem;
      border: 2px solid #2563eb;
      border-radius: 8px;
      font-size: 1rem;
      color: #2563eb;
      background-color: #ffffff;
    }
    button {
      background-color: #2563eb;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #1e40af;
    }
    img {
      max-width: 100%;
      margin-top: 1rem;
      border-radius: 8px;
    }
    .download-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: #2563eb;
      color: white;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
    }
    .download-btn:hover {
      background-color: #1e40af;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- AdSense Ad Unit - Top of Page - Replace with your ad code -->
    <div style="margin-bottom: 15px; text-align: center;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
           data-ad-slot="YOUR_AD_SLOT_ID"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      <small>Advertisement</small>
    </div>
    <!-- End AdSense Ad Unit -->
    <h1>Image Background Remover & Optimizer</h1>
    <input type="file" id="imageInput" accept="image/*" />
    <div>
      <label for="removeBgApiKey">Remove.bg API Key:</label>
      <input type="text" id="removeBgApiKey" placeholder="Enter your Remove.bg API Key">
      <small>Get your API key from <a href="https://www.remove.bg/api" target="_blank">remove.bg</a>. The key is processed in your browser.</small>
    </div>
    <button onclick="removeBackground()">Remove Background</button>
    <select id="formatSelect">
      <option value="png">PNG</option>
      <option value="jpeg">JPG</option>
      <option value="gif">GIF</option>
      <option value="webp">WebP</option>
    </select>
    <div>
      <label for="compressionQuality">Compression Quality (for JPG/WebP):</label>
      <input type="range" id="compressionQuality" min="0.1" max="1.0" value="0.9" step="0.05">
      <span id="qualityValue">0.9</span> 
      <small>Lower values mean smaller file size but lower quality.</small>
    </div>
    <button onclick="convertImage()">Convert Image</button>

    <div id="previewContainer">
      <div id="originalPreviewArea" style="margin-bottom: 1rem;">
        <!-- Populated by imageInput change event -->
      </div>
      <div id="bgRemovedPreviewArea" style="margin-bottom: 1rem;">
        <!-- Populated by removeBackground() -->
      </div>
      <div id="finalPreviewArea">
        <!-- Populated by convertImage() -->
      </div>
    </div>
    <!-- AdSense Ad Unit - Bottom of Page - Replace with your ad code -->
    <div style="margin-top: 15px; text-align: center;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
           data-ad-slot="YOUR_AD_SLOT_ID"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      <small>Advertisement</small>
    </div>
    <!-- End AdSense Ad Unit -->
  </div>

  <script>
    let originalFile;
    let currentImageBlob = null; // To store the image blob after background removal or original if not removed

    document.getElementById('imageInput').addEventListener('change', function(e) {
      originalFile = e.target.files[0];
      currentImageBlob = originalFile; // Initially, current image is the original one
      
      const originalPreviewArea = document.getElementById('originalPreviewArea');
      originalPreviewArea.innerHTML = '<p>Original Preview:</p>' + 
                                      '<img src="' + URL.createObjectURL(originalFile) + '" alt="Original Image" id="originalPreviewImage">' +
                                      '<br><a class="download-btn" href="' + URL.createObjectURL(originalFile) + '" download="' + originalFile.name + '">Download Original Image</a>';
      
      // Clear subsequent preview areas when a new file is uploaded
      document.getElementById('bgRemovedPreviewArea').innerHTML = '';
      document.getElementById('finalPreviewArea').innerHTML = '';
    });

    async function removeBackground() {
      if (!originalFile) {
        alert("Please upload an image first.");
        return;
      }
      const apiKey = document.getElementById('removeBgApiKey').value;
      if (!apiKey) {
        alert("Please enter your Remove.bg API Key.");
        return;
      }

      const formData = new FormData();
      formData.append('image_file', originalFile);
      formData.append('size', 'auto');

      const bgRemovedPreviewArea = document.getElementById('bgRemovedPreviewArea');
      const finalPreviewArea = document.getElementById('finalPreviewArea');
      bgRemovedPreviewArea.innerHTML = '<p>Processing background removal...</p>'; // Provide feedback
      finalPreviewArea.innerHTML = ''; // Clear final preview if we are re-processing background

      try {
        const response = await fetch('https://api.remove.bg/v1.0/removebg', {
          method: 'POST',
          headers: {
            'X-Api-Key': apiKey,
          },
          body: formData,
        });

        if (response.ok) {
          const blob = await response.blob();
          currentImageBlob = blob; // Update currentImageBlob with the processed image
          const processedImageUrl = URL.createObjectURL(blob);
          
          bgRemovedPreviewArea.innerHTML = '<p>Background Removed Preview:</p>' +
                                           '<img src="' + processedImageUrl + '" alt="Background Removed Image" id="backgroundRemovedImage">' +
                                           '<a class="download-btn" href="' + processedImageUrl + '" download="background-removed-image.png">Download Background Removed Image</a>';

        } else {
          const errorData = await response.json();
          bgRemovedPreviewArea.innerHTML = '<p style="color: red;">Error removing background: ' + (errorData.errors ? errorData.errors[0].title : 'Unknown error') + '</p>';
        }
      } catch (error) {
        console.error('Error:', error);
        bgRemovedPreviewArea.innerHTML = '<p style="color: red;">Failed to remove background. Check console for details.</p>';
      }
    }

    function convertImage() {
      const imageToConvert = currentImageBlob || originalFile; // Use processed image if available

      if (!imageToConvert) {
        alert("Please upload an image first.");
        return;
      }

      const format = document.getElementById("formatSelect").value;
      const quality = parseFloat(document.getElementById('compressionQuality').value);
      const reader = new FileReader();
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      const img = new Image();

      reader.onload = function(event) {
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          canvas.toBlob(function(outputBlob) { 
            currentImageBlob = outputBlob; // Update currentImageBlob with the converted/compressed image
            const convertedUrl = URL.createObjectURL(outputBlob);
            const finalPreviewArea = document.getElementById("finalPreviewArea");
            let previewLabel = '<p>Final Converted Preview:</p>';
            if (format === 'jpeg' || format === 'webp') {
              previewLabel = '<p>Final Converted/Optimized Preview (Quality: ' + quality + '):</p>';
            }
            finalPreviewArea.innerHTML = previewLabel +
                                         '<img src="' + convertedUrl + '" alt="Converted/Optimized Image" id="finalPreviewImage">' +
                                         '<a class="download-btn" href="' + convertedUrl + '" download="converted-image-' + ( (format === 'jpeg' || format === 'webp') ? quality + '.' : '' ) + format + '">Download Final Image</a>';
          }, 'image/' + format, quality); // Pass quality to toBlob
        };
        // If imageToConvert is a Blob (e.g. from removeBackground), create an Object URL for img.src
        // Otherwise, it's a File object from input, which FileReader handles directly with event.target.result
        if (imageToConvert instanceof Blob) {
            img.src = URL.createObjectURL(imageToConvert);
        } else { 
            img.src = event.target.result; // Should be originalFile if imageToConvert is not a Blob
        }
      };

      // FileReader expects a Blob or File. Both originalFile and currentImageBlob (if set) are fine.
      reader.readAsDataURL(imageToConvert);
    }

    const qualitySlider = document.getElementById('compressionQuality');
    const qualityValueDisplay = document.getElementById('qualityValue');
    if (qualitySlider && qualityValueDisplay) { 
        qualitySlider.addEventListener('input', function() {
            qualityValueDisplay.textContent = this.value;
        });
    } else {
        console.error("Compression quality slider or display element not found.");
    }
  </script>
</body>
</html>
  
  
